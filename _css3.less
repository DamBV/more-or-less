@import '_fn';

@vendorPrefixes: -webkit-, -moz-, -o-, -ms-, ~'';

// MIXIN: .prop (loop through values for vendor-prefixing)
.prop(@p;@s;@in;@n) when     (@in <= @n)    {.-vendor(@p;false;@in);}
.prop(@p;@s;@n)     when not (isnumber(@n)) {.prop(@p;false;1;length(@n));}
.prop(@p;@s;@in;@n) when not (@in = @n)     {.prop(@p;false;@in + 1;@n);}

// MIXIN: .-frames (loop throug frames for kayframe-animations)
.frames(@i;@n) when     (@i < @n)     {.-frame(@i);}
.frames(@n)    when not (isnumber(@n)) {.frames(1;length(@n));}
.frames(@i;@n) when not (@i = @n)      {.frames(@i + 1;@n);}

// MIXIN: .map-frames (map for keyframes)
.map-frames (@propy-list...) {
    .for(@propy-list);.-each(@i) {
        @propy: extract(@propy-list, @i);
        @propa: extract(@propy, 1);
        @{propa}: extract(@propy, 2);
    }
}

// MIXIN: .-vendor (prefixes properties)
.-vendor(@prop;@sep;@in) {
    // space separation is awaiting pull request
    // property+_: is currently not supported
    @value: extract(@values, @in);
    .-true() when (@sep = false) {@{vendorPrefix}@{prop}+: ~'@{vendorPrefix}@{value}';}
    //.-true() when (@sep = _) {@{vendorPrefix}@{prop}+_: ~'@{vendorPrefix}@{value}';}
    .-false() when (@sep = false) {@{vendorPrefix}@{prop}+: @value;}
    //.-false() when (@sep = _) {@{vendorPrefix}@{prop}+_: @value;}
    .-call(transform) {.-true;}
    .-call(box-shadow){.-true;}
    .-call(...) when (default()){.-false;}
    .-call(@value);
}

// MIXIN: .-return (returns prefixed properties)
.-return(@prop) {
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        @{vendorPrefix}@{prop}: @values;
    }
}

// MIXIN: .background-size
.background-size(@values...) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=background-size
    .-return(background-size);
}

// MIXIN: .border-radius
.border-radius(@values) {
    @vendorPrefixes: -webkit-, -moz-, ~'';
    // http://caniuse.com/#search=border-radius
    .-return(border-radius);
}

// MIXIN: .box-sizing
.box-sizing(@values) {
    @vendorPrefixes: -webkit-, -moz-, ~'';
    // http://caniuse.com/#search=box-sizing
    .-return(box-sizing);
}

// MIXIN: .box-shadow
.box-shadow(@values...) {
    @vendorPrefixes: -webkit-, -moz-, ~'';
    // http://caniuse.com/#search=box-sizing
    .-return(box-shadow);
}

// MIXIN: .calc
.calc(@prop; @value) {
    @vendorPrefixes: -webkit-, -moz-, ~'';
    // http://caniuse.com/#search=calc
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        @eValue: ~'@{value}';
        @{prop}: ~'@{vendorPrefix}calc(@{eValue})';
    }
}

// MIXIN: .opacity
.opacity(@value) {
    // http://caniuse.com/#search=opacity
    @msValue: (@value * 100);
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=@{msValue})";
    filter: alpha(opacity=@msValue);
    opacity: @value;
}

// MIXIN: .text-overflow
.text-overflow(@value) {
    @vendorPrefixes: -ms-, -o-, ~'';
    // http://caniuse.com/#search=text-overflow
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        @{vendorPrefix}text-overflow: @value;
    }
    // props needed
    display: inline-block; // may be overridden with block
    max-width: 100%;
    overflow: hidden;
    white-space: no-wrap;
    word-wrap: normal;
    // IE fixes
    *display: inline;
    *zoom: 1;
}

// MIXIN: .perspective
.perspective(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(perspective);
}
// MIXIN: .transform-origin
.perspective-origin(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(perspective-origin);
}
// MIXIN: .transform
.transform(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(transform);
}

// MIXIN: .transform-origin
.transform-origin(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(transform-origin);
}

// MIXIN: .transform-style
.transform-style(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(transform-style);
}

// MIXIN: .backface-visibility
.backface-visibility(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transform
    .-return(backface-visibility);
}

// MIXIN: .transition
.transition(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transition
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        .prop(transition-property;false;@values);
    }
}

// MIXIN: .transition-property
.transition-property(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transition
    // http://caniuse.com/#search=transform
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        .prop(transition-property;false;@values);
    }
}

// MIXIN: .transition-duration
.transition-duration(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transition
    .-return(transition-duration);
}

// MIXIN: .transition-delay
.transition-delay(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transition
    .-return(transition-delay);
}

// MIXIN: .transition-timing-function
.transition-timing-function(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=transition
    .-return(transition-timing-function);
}

// MIXIN: .animation
.animation(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation);
}

// MIXIN: .animation-delay
.animation-delay(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-delay);
}

// MIXIN: .animation-duration
.animation-duration(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-duration);
}

// MIXIN: .animation-direction
.animation-direction(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-direction);
}

// MIXIN: .animation-duration
.animation-duration(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-duration);
}

// MIXIN: .animation-fill-mode
.animation-fill-mode(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-fill-mode);
}

// MIXIN: .animation-iteration-count
.animation-iteration-count(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-iteration-count);
}

// MIXIN: .animation-name
.animation-name(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-name);
}

// MIXIN: .animation-play-state
.animation-play-state(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-play-state);
}

// MIXIN: .animation-timing-function
.animation-timing-function(@values) {
    @vendorPrefixes: -webkit-, -moz-, -o-, ~'';
    // http://caniuse.com/#search=animation
    .-return(animation-timing-function);
}

// MIXIN: .keyframes

.keyframes(@name;@mapFrom;@mapTo) {
    @localVendorPrefixes: -webkit-, -moz-, -o-, ~'';
    //http://caniuse.com/#search=animation
    .-from (@map...) {
        .map-frames(@map);
    }
    .-to (@map...) {
        .map-frames(@map);
    }
    .frames(@vendorPrefixes);.-frame(@i) when (@i = 1) {
        @localVendorPrefix: extract(@localVendorPrefixes, @i);
        @k: ~'@@{localVendorPrefix}keyframes @{name} { `"\n"`from ';
        @{k} {
            .-from(@mapFrom);
        }
        to {
            .-to(@mapTo);
        }
    }
    .frames(@vendorPrefixes);.-frame(@i) when (@i > 1) {
        @localVendorPrefix: extract(@localVendorPrefixes, @i);
        @k: ~'} `"\n"` @@{localVendorPrefix}keyframes @{name} { `"\n"`from ';
        @{k} {
            .-from(@mapFrom);
        }
        to {
            .-to(@mapTo);
        }
    }
    @anim: ~'} `"\n"`.@{name}';
    @{anim} {
        .animation-name(@name);
    }
}

// MIXIN: .user-select
.user-select(@values) {
    @vendorPrefixes: -webkit-, -moz-, -ms-, ~'';
    // http://caniuse.com/#search=user-select
    .-return(user-select);
}

// MIXIN: .appearance
.appearance(@values) {
    @vendorPrefixes: -webkit-, -moz- ~'';
    // https://developer.mozilla.org/en-US/docs/Web/CSS/-moz-appearance
    .-return(appearance);
}

// MIXIN: .placeholder
.placeholder(@values) {
    @vendorPrefixes: ~':-webkit-', ~':-moz-', ~'-moz-', ~':-ms-';
    // http://caniuse.com/#search=placeholder
    .for(@vendorPrefixes);.-each(@i) {
        @vendorPrefix: extract(@vendorPrefixes, @i);
        @selector: ~':@{vendorPrefix}placeholder';
        &@{selector} {
            color: @values;
        }
    }
}